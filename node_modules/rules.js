

exports.inject = function (default_location, urlparser, readFile) {
	return [
		// Case 1: json call
		{
			valid : function (u) {return u.req.url.indexOf('/j/')==0;},
			run : function (u) {
				u.res.writeHead(200, {'Content-Type': 'text/json'});
				u.res.end('{}');
			}
		},
		// Case 2: root url
		{
			valid : function (u) {return u.req.url=="/"},
			run : function (u) {
				// we update to default location
				var parsed = urlparser(u.req.url, true);
				u.req.url=default_location;
				return u;
			}
		},
		// Case 3: static files
		{
			valid : function (u) {return true},
			run : function (u) {
				var parsed = urlparser(u.req.url, true);
				readFile('./static' + parsed.pathname, function (err, data) {
					if (!err) {
						u.res.writeHead(200, {'Content-Type': 'text/html'});
						u.res.end(data);
					} else {
						u.res.writeHead(404, {'Content-Type': 'text/html'});
						u.res.end("<html><body>404 not found</body></html>");
					}
				});
			}
		}
	]
}
